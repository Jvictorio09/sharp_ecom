{% extends "base.html" %} {% block title %}{{ product.name }} — SHARP{% endblock
%} {% block content %}

<section class="py-10 md:py-16 bg-cream">
  <div class="max-w-7xl mx-auto px-4 md:px-8">
    <!-- Breadcrumbs -->
    <nav class="text-xs mb-6 text-ink/70">
      <a href="{% url 'home' %}" class="hover:underline">Home</a>
      <span class="mx-2">/</span>
      <a href="{% url 'product_list' %}" class="hover:underline">Products</a>
      <span class="mx-2">/</span>
      <span class="text-ink">{{ product.name }}</span>
    </nav>

    <div class="grid lg:grid-cols-5 gap-10">
      <!-- GALLERY -->
      <div class="lg:col-span-3">
        <div class="grid md:grid-cols-5 gap-4">
          <!-- Thumbs -->
          <div class="order-2 md:order-1 md:col-span-1 flex md:flex-col gap-3">
            {% if product.gallery %} {% for img in product.gallery %}
            <button
              class="thumb w-20 h-20 rounded-xl overflow-hidden border border-line bg-ivory hover:border-[var(--sharp-gold)]"
              data-src="{{ img }}"
              aria-label="View image {{ forloop.counter }}"
            >
              <img
                src="{{ img }}"
                alt="{{ product.name }} {{ forloop.counter }}"
                class="w-full h-full object-cover"
              />
            </button>
            {% endfor %} {% else %}
            <!-- Fallback duplicate thumbs from main image -->
            {% for i in "123" %}
            <button
              class="thumb w-20 h-20 rounded-xl overflow-hidden border border-line bg-ivory hover:border-[var(--sharp-gold)]"
              data-src="{{ product.image_url }}"
              aria-label="View image {{ forloop.counter }}"
            >
              <img
                src="{{ product.image_url }}"
                alt="{{ product.name }} {{ forloop.counter }}"
                class="w-full h-full object-cover"
              />
            </button>
            {% endfor %} {% endif %}
          </div>

          <!-- Main image -->
          <div
            class="order-1 md:order-2 md:col-span-4 rounded-2xl overflow-hidden bg-ivory relative group"
          >
            <img
              id="mainImage"
              src="{{ product.image_url }}"
              alt="{{ product.name }}"
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.02]"
            />
            <div
              class="absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-black/5 to-transparent"
            ></div>
            {% if product.badge %}
            <span
              class="absolute top-4 left-4 px-3 py-1 rounded-full text-xs font-medium bg-white/95 border border-line backdrop-blur"
            >
              {{ product.badge }}
            </span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- BUY BOX -->
      <aside class="lg:col-span-2 lg:sticky lg:top-24 h-max">
        <div class="bg-white border border-line rounded-2xl p-6 space-y-5">
          <p class="uppercase tracking-[0.18em] text-xs text-ink/60">
            {{ product.badge|default:"Studio Edition" }}
          </p>

          <h1 class="text-2xl md:text-4xl font-extrabold leading-tight">
            {{ product.name }}
          </h1>
          {% if product.subtitle %}
          <p class="text-ink/70">{{ product.subtitle }}</p>
          {% endif %}

          <div class="flex items-center gap-3">
            <p class="text-2xl font-semibold">JD{{ product.price }}</p>
            {% if product.compare_price and product.compare_price >
            product.price %}
            <p class="text-sm line-through opacity-60">
              JD{{ product.compare_price }}
            </p>
            {% endif %}
          </div>

          <!-- Key benefits -->
          <ul class="mt-2 space-y-2 text-sm">
            <li class="flex items-start gap-2">
              <span
                class="mt-1 w-1.5 h-1.5 rounded-full bg-[var(--sharp-gold)]"
              ></span>
              Lab-tested, daily-use formulas
            </li>
            <li class="flex items-start gap-2">
              <span
                class="mt-1 w-1.5 h-1.5 rounded-full bg-[var(--sharp-gold)]"
              ></span>
              Carbon-neutral shipping
            </li>
            <li class="flex items-start gap-2">
              <span
                class="mt-1 w-1.5 h-1.5 rounded-full bg-[var(--sharp-gold)]"
              ></span>
              30-day no-questions guarantee
            </li>
          </ul>

          <!-- Controls -->
          <!-- Qty + Add to Bag -->
          <div class="mt-6 flex items-center gap-3">
            <div
              class="flex items-center rounded-full border border-line overflow-hidden"
            >
              <button
                type="button"
                class="qtyBtn w-10 h-10"
                data-delta="-1"
                aria-label="Decrease quantity"
              >
                −
              </button>
              <input
                id="qty"
                type="number"
                min="1"
                value="1"
                class="w-12 h-10 text-center outline-none"
                aria-label="Quantity"
              />
              <button
                type="button"
                class="qtyBtn w-10 h-10"
                data-delta="1"
                aria-label="Increase quantity"
              >
                +
              </button>
            </div>

            <button
              class="btn flex-1 px-6 py-3 rounded-full text-white bg-[var(--sharp-gold)] hover:bg-[var(--sharp-hunter)]"
              data-add-to-cart="{{ product.id }}"
              data-qty-el="#qty"
            >
              Add to Bag
            </button>
          </div>

          <!-- Buy Now (full width, aligned) -->
          <div class="mt-3">
            <a
              href="{% url 'checkout' %}"
              class="btn w-full px-6 py-3 rounded-full border border-line bg-white hover:border-[var(--sharp-gold)] text-center"
            >
              Buy Now
            </a>
          </div>

          <!-- Trust / meta -->
          <div
            class="flex items-center justify-between text-xs opacity-80 pt-2"
          >
            <span>Encrypted checkout</span>
            <span>Ships in 24–48h</span>
            <span>Easy returns</span>
          </div>

          <!-- Accordions -->
          <div
            class="mt-3 divide-y divide-[var(--sharp-line)] border-t border-[var(--sharp-line)]"
          >
            <details class="group py-3">
              <summary class="flex items-center justify-between cursor-pointer">
                <span class="font-medium text-sm">Details</span>
                <span class="transition-transform group-open:rotate-180"
                  >⌄</span
                >
              </summary>
              <div class="pt-3 text-sm opacity-90">
                {% if product.description %} {{ product.description|safe }} {%
                else %}
                <p>
                  Made with premium, traceable materials and designed for daily
                  use. Built to last, backed by our 30-day guarantee.
                </p>
                {% endif %}
              </div>
            </details>

            <details class="group py-3">
              <summary class="flex items-center justify-between cursor-pointer">
                <span class="font-medium text-sm">Shipping & Delivery</span>
                <span class="transition-transform group-open:rotate-180"
                  >⌄</span
                >
              </summary>
              <div class="pt-3 text-sm opacity-90">
                <p>
                  We ship carbon-neutral nationwide. Standard 3–5 business days,
                  Express 1–2 business days.
                </p>
              </div>
            </details>

            <details class="group py-3">
              <summary class="flex items-center justify-between cursor-pointer">
                <span class="font-medium text-sm">Returns</span>
                <span class="transition-transform group-open:rotate-180"
                  >⌄</span
                >
              </summary>
              <div class="pt-3 text-sm opacity-90">
                <p>
                  30-day no-questions guarantee. If it’s not right, we’ll make
                  it right.
                </p>
              </div>
            </details>
          </div>
        </div>
      </aside>
    </div>

    {% if related %}
    <div class="mt-16">
      <div class="flex items-end justify-between gap-4 mb-6">
        <h2 class="text-lg md:text-2xl font-extrabold">Pairs well with</h2>
        <a
          href="{% url 'product_list' %}"
          class="text-sm underline underline-offset-4 hover:text-[var(--sharp-gold)]"
          >View all</a
        >
      </div>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
        {% for p in related %} {% include "partials/_product_card.html" with p=p
        %} {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</section>

<!-- PDP micro-interactions (no deps) -->
<script>
  // Thumbs → main image swap
  document.querySelectorAll(".thumb").forEach((btn) => {
    btn.addEventListener("click", () => {
      const src = btn.getAttribute("data-src");
      const main = document.getElementById("mainImage");
      if (!main || !src) return;
      // subtle crossfade
      main.style.opacity = "0";
      setTimeout(() => {
        main.src = src;
        main.style.opacity = "1";
      }, 120);
    });
  });

  // Quantity buttons
  const qtyEl = document.getElementById("qty");
  document.querySelectorAll(".qtyBtn").forEach((b) => {
    b.addEventListener("click", () => {
      const delta = parseInt(b.getAttribute("data-delta") || "0", 10);
      const current = Math.max(1, parseInt(qtyEl.value || "1", 10) + delta);
      qtyEl.value = current;
    });
  });

  // Map qty to add-to-cart button via data-qty-el
  document.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-qty-el][data-add-to-cart]");
    if (!btn) return;
    const ref = btn.getAttribute("data-qty-el");
    const input = document.querySelector(ref);
    if (input) btn.setAttribute("data-qty", input.value || "1");
  });
</script>

{% endblock %}
