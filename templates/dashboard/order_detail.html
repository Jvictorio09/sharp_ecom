{% extends "dashboard/base_dashboard.html" %}
{% block content %}
<div class="grid lg:grid-cols-3 gap-6">
  <!-- Left: Summary -->
  <section class="lg:col-span-2 space-y-6">

    <div class="rounded-2xl border border-[#E1E1E1] bg-white p-6">
      <div class="flex items-center justify-between">
        <h1 class="text-xl font-extrabold">Order {{ order.order_number }}</h1>
        <span class="text-sm px-3 py-1 rounded-full border border-[#E1E1E1]">{{ order.get_status_display }}</span>
      </div>
      <p class="text-sm text-black/60 mt-2">Placed {{ order.created_at|date:"M d, Y H:i" }}</p>

      <div class="mt-6 overflow-hidden rounded-xl border border-[#E1E1E1]">
        <table class="w-full text-sm">
          <thead class="bg-[#FAFAF8]">
            <tr>
              <th class="text-left px-4 py-3">Item</th>
              <th class="text-left px-4 py-3">Qty</th>
              <th class="text-left px-4 py-3">Unit</th>
              <th class="text-left px-4 py-3">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for it in order.items.all %}
            <tr class="border-t border-[#E1E1E1]">
              <td class="px-4 py-3">{{ it.name }}</td>
              <td class="px-4 py-3">{{ it.quantity }}</td>
              <td class="px-4 py-3">JD{{ it.unit_price }}</td>
              <td class="px-4 py-3">JD{{ it.line_total }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-4 grid sm:grid-cols-2 gap-4 text-sm">
        <div class="rounded-xl border border-[#E1E1E1] p-4 bg-[#FCFCFA]">
          <p class="font-semibold mb-1">Customer</p>
          <p>{{ order.full_name }}</p>
          <p class="text-black/60">{{ order.email }}</p>
          <p class="text-black/60">{{ order.phone }}</p>
        </div>
        <div class="rounded-xl border border-[#E1E1E1] p-4 bg-[#FCFCFA]">
          <p class="font-semibold mb-1">Ship to</p>
          <p>{{ order.address_line1 }}</p>
          <p class="text-black/60">{{ order.city }} {{ order.province }} {{ order.zip_code }}</p>
          <p class="text-black/60">Method: {{ order.shipping_method|title }}</p>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-[#E1E1E1] bg-white p-6">
      <p class="font-semibold mb-3">Totals</p>
      <div class="text-sm space-y-2">
        <div class="flex items-center justify-between"><span>Subtotal</span><span>JD{{ order.subtotal }}</span></div>
        <div class="flex items-center justify-between"><span>Shipping</span><span>JD{{ order.shipping_cost }}</span></div>
        <div class="flex items-center justify-between"><span>Discount</span><span>JD{{ order.discount_total }}</span></div>
        <div class="pt-2 border-t border-[#E1E1E1] flex items-center justify-between text-base">
          <span class="font-semibold">Grand Total</span><span class="font-semibold">JD{{ order.grand_total }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Right: Actions -->
  <aside class="space-y-6">
    <div class="rounded-2xl border border-[#E1E1E1] bg-white p-6">
      <p class="font-semibold mb-3">Update Status</p>
      <form method="post" action="{% url 'dashboard_order_update_status' order.order_number %}">
        {% csrf_token %}
        <label class="text-sm">Status</label>
        <select name="status" class="block w-full mt-1 px-4 py-2.5 rounded-xl border border-[#E1E1E1] bg-white mb-3">
          {% for value,label in order.STATUS_CHOICES %}
            <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>

        <label class="inline-flex items-center gap-2 text-sm mb-4">
          <input type="checkbox" name="notify" class="rounded border-[#E1E1E1]">
          <span>Email customer about this update</span>
        </label>

        <button class="w-full px-5 py-2.5 rounded-full text-white bg-[var(--sharp-mineral)] hover:bg-[var(--sharp-hunter)]">
          Save
        </button>
      </form>
    </div>

    <div class="rounded-2xl border border-[#E1E1E1] bg-white p-6 text-sm">
      <p class="font-semibold mb-2">Meta</p>
      <p><span class="text-black/60">Created:</span> {{ order.created_at|date:"M d, Y H:i" }}</p>
      <p><span class="text-black/60">Updated:</span> {{ order.updated_at|date:"M d, Y H:i" }}</p>
      <p><span class="text-black/60">Payment:</span> {{ order.payment_method|upper }}</p>
    </div>
  </aside>
</div>
{% endblock %}
